{"version":3,"sources":["logo.svg","App.js","index.js"],"names":["module","exports","__webpack_require__","p","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","year","data","filteredData","totals","bike","run","workout","monthly","filter","streaks","current","start","length","longest","Promise","resolve","Tabletop","init","key","callback","sheets","elements","wanted","rawData","map","day","date","Number","comments","reduce","total","dayDiff","dateFrom","dateTo","Math","abs","Date","acc","curr","result","month","moment","format","push","entries","_ref","_ref2","slicedToArray","days","sum","fetchData","prevProps","prevState","_this2","setState","calculateFilteredData","_this3","loadSheet","then","normalize","calculateYearlyTotals","calculateStreaksOfActivity","calculateMonthlyTotals","ReactTooltip","rebuild","catch","e","console","error","bikeWeight","includes","runWeight","workoutWeight","objectSpread","score","_this4","react_default","a","createElement","className","src","logo","alt","build_default","startDate","concat","endDate","values","classForValue","showWeekdayLabels","tooltipDataAttrs","value","lines","data-tip","join","weekdayLabels","type","checked","onChange","role","aria-label","floor","_ref3","_ref4","dist_default","effect","multiline","Component","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.8d4fc3ce.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.ff816526.svg\";","import React, { Component } from 'react';\nimport CalendarHeatmap from 'react-calendar-heatmap';\nimport Tabletop from 'tabletop';\nimport ReactTooltip from 'react-tooltip'\nimport moment from 'moment';\n\nimport logo from './logo.svg';\nimport './App.css';\nimport './react-calendar-heatmap.css';\n\nclass App extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      year: '2019',\n      // data: [  // example data\n      //   { date: '2018-06-01', bike: \"25\", run: \"0\", workout: \"60\", comments: \"been there, done that\" },\n      //   { date: '2018-06-03', bike: \"48\", run: \"0\", workout: \"\" },\n      //   { date: '2018-06-06', bike: \"3\", run: \"10\", workout: \"\" },\n      // ],\n      data: [],\n      filteredData: [],\n      totals: {\n        bike: 0, // km\n        run: 0, // km\n        workout: 0, //mins\n      },\n      monthly: {},\n      filter: 'all',\n      streaks: { current: { start: '', length: 0 }, longest: { start: '', length: 0 } },\n    };\n  }\n\n  loadSheet(year) {\n    // TODO error handling\n    return new Promise((resolve) => {\n      const sheetUrl = 'https://docs.google.com/spreadsheets/d/1CK1dlXslA7_wRth0SYvTf4wY2xgzk2gKGD1uw6SVyKg/edit?usp=sharing';\n\n      const callback = (sheets) => {\n        resolve(sheets[year].elements);\n      };\n      Tabletop.init({ key: sheetUrl, callback, wanted: [year] });\n    });\n  }\n\n  normalize(rawData) {\n    return rawData.map(day => ({\n      date: day.date,\n      bike: Number(day.bike || 0),\n      run: Number(day.run || 0),\n      workout: Number(day.workout || 0),\n      comments: day.comments,\n    }))\n    // filter out the days with no activity\n    .filter(day => (day.bike + day.run + day.workout > 0));\n  }\n\n  calculateYearlyTotals(data) {\n    return data.reduce((total, day) => {\n      total.bike += day.bike;\n      total.run += day.run;\n      total.workout += day.workout;\n      return total;\n    }, { bike: 0, run: 0, workout: 0 });\n  }\n\n  calculateStreaksOfActivity(data) {\n    const dayDiff = (dateFrom, dateTo) => Math.abs(new Date(dateTo) - new Date(dateFrom)) / (1000 * 60 * 60 * 24);\n\n    // find the longest streak of activity\n    const streaks = data.reduce((acc, curr) => {\n      if (!acc.start) {\n        return { start: curr.date, length: 1, longest: { start: curr.date, length: 1 } };\n      }\n      if (dayDiff(acc.start, curr.date) === acc.length) { // streak continues\n        acc.length++;\n      } else { // streak interrupted\n        if (acc.length > acc.longest.length) {\n          acc.longest = { start: acc.start, length: acc.length };\n        }\n        acc.start = curr.date;\n        acc.length = 1;\n      }\n      return acc;\n    }, {});\n\n    // see if the current streak is the longest one\n    const longest = (streaks.length > streaks.longest.length)\n      ? { start: streaks.start, length: streaks.length }\n      : streaks.longest;\n\n    const current = dayDiff(streaks.start, new Date()) <= streaks.length + 1\n      ? { start: streaks.start, length: streaks.length }\n      : { length: 0 };\n\n    return { longest, current };\n  }\n\n  calculateMonthlyTotals(data) {\n    const result = data\n      .reduce((acc, day) => {\n        const month = moment(day.date).format('MMMM');\n        (acc[month] = acc[month] || []).push(day);\n        return acc;\n      }, {});\n    // result is: { January: [{},{},{}], February: [{},...], ... }\n\n    return Object.entries(result).reduce((acc, [month, days]) => {\n      // reduce days in a month:\n      acc[month] = days.reduce((sum, day) => {\n        sum.bike += day.bike;\n        sum.run += day.run;\n        sum.workout += day.workout;\n        return sum;\n      }, { bike: 0, run: 0, workout: 0 });\n      return acc;\n    }, {});\n  }\n\n  componentWillMount() {\n    this.fetchData(this.state.year);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.year !== prevState.year) {\n      this.fetchData(this.state.year);\n    }\n    if (this.state.filter !== prevState.filter) {\n      this.setState(state => ({\n        filteredData: this.calculateFilteredData(state.data, state.filter)\n      }));\n    }\n  }\n\n  fetchData(year) {\n    this.loadSheet(year)\n      .then(rawData => {\n        // console.log(rawData);\n        // debugger;\n\n        const data = this.normalize(rawData);\n        const totals = this.calculateYearlyTotals(data);\n        const streaks = this.calculateStreaksOfActivity(data);\n        const monthly = this.calculateMonthlyTotals(data);\n        const filter = 'all';\n        const filteredData = this.calculateFilteredData(data, filter);\n        this.setState({ data, totals, monthly, streaks, filter, filteredData });\n\n        ReactTooltip.rebuild();\n      })\n      .catch(e => console.error(e));\n  }\n\n  calculateFilteredData(data, filter) {\n    // weights: 5km by bike is my equivalent of a 1km run or a 10min workout\n    const bikeWeight = ['all', 'bike'].includes(filter) ? 1 : 0;\n    const runWeight = ['all', 'run'].includes(filter) ? 5 : 0;\n    const workoutWeight = ['all', 'workout'].includes(filter) ? 0.5 : 0;\n\n    // calculate the \"day score\"\n    return data.map(day => ({\n      ...day,\n      score: day.bike * bikeWeight + day.run * runWeight + day.workout * workoutWeight,\n    }));\n  }\n\n  classForValue(day) {\n    if (!day) return 'color-empty';\n\n    if (day.score === 0) return 'color-empty';\n    if (day.score < 10) return 'color-github-1';\n    if (day.score < 25) return 'color-github-2';\n    if (day.score < 50) return 'color-github-3';\n    return 'color-github-4';\n  }\n\n  render() {\n    const customTooltipDataAttrs = (value) => {\n      if (!value || !value.date) return;\n\n      const lines = [ value.date ];\n      value.bike && lines.push(`${value.bike} km by bike`);\n      value.run && lines.push(`${value.run} km ran`);\n      value.workout && lines.push(`${value.workout} min of workout`);\n      value.comments && lines.push(value.comments);\n\n      return { 'data-tip': lines.join('<br />') };\n    };\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <h1 className=\"App-title\">Unstoppable.</h1>\n        </header>\n        <div className=\"HeatmapContainer\">\n          <div className=\"Heatmap\">\n            <CalendarHeatmap\n              startDate={new Date(`${this.state.year}-01-01`)}\n              endDate={new Date(`${this.state.year}-12-31`)}\n              values={this.state.filteredData}\n              classForValue={this.classForValue}\n              showWeekdayLabels\n              tooltipDataAttrs={customTooltipDataAttrs}\n              weekdayLabels={['', 'Mo', '', 'We', '', 'Fri', '']}\n            />\n          </div>\n          <div className=\"Filters\">\n            <div>\n              <input type=\"radio\"\n                checked={this.state.filter === 'all'}\n                onChange={() => this.setState({ filter: 'all' })}\n              />\n              <span role=\"img\" aria-label=\"all\"> &#x1F30D;</span>\n            </div>\n            <div>\n              <input type=\"radio\"\n                checked={this.state.filter === 'bike'}\n                onChange={() => this.setState({ filter: 'bike' })}\n              />\n              <span role=\"img\" aria-label=\"bike\"> &#x1F6B4;</span>\n            </div>\n            <div>\n              <input type=\"radio\"\n                checked={this.state.filter === 'run'}\n                onChange={() => this.setState({ filter: 'run' })}\n              />\n              <span role=\"img\" aria-label=\"run\"> &#x1F3C3;</span>\n            </div>\n            <div>\n              <input type=\"radio\"\n                checked={this.state.filter === 'workout'}\n                onChange={() => this.setState({ filter: 'workout' })}\n              />\n              <span role=\"img\" aria-label=\"workout\"> &#x1F3CB;</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"Totals\">\n          Total of {this.state.totals.bike} km by &#x1F6B4;, {this.state.totals.run} km by &#x1F3C3;\n          and {Math.floor(this.state.totals.workout / 60)} hours of &#x1F3CB; this year.<br/>\n          Current streak of activity is {this.state.streaks.current.length} days. Longest is {this.state.streaks.longest.length} days.\n        </div>\n\n        {\n          ['bike', 'run', 'workout'].includes(this.state.filter) &&\n          (<div className=\"mt\">\n            {Object.entries(this.state.monthly).map(([month, totals]) => (\n              <div key={month}>{month}: {totals[this.state.filter]}</div>\n            ))}\n          </div>)\n        }\n\n        <div className=\"mt\">\n          <input type=\"radio\"\n            checked={this.state.year === '2018'}\n            onChange={() => this.setState({ year: '2018' })}\n          /> 2018\n          <input type=\"radio\"\n            checked={this.state.year === '2019'}\n            onChange={() => this.setState({ year: '2019' })}\n          /> 2019\n        </div>\n\n        <ReactTooltip effect=\"solid\" multiline />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}